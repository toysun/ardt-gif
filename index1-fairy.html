<html>
  <head>
    <!--title>AR HMS Busan</title-->
    <meta charset="utf-8" />
    <meta http-equiv="Cache-control" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Pragma" content="no-cache" /> 
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />

    <!-- settings for favicons -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./favicon/ardocent_180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./favicon/ardocent_32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./favicon/ardocent_16x16.png"
    />
    <link rel="manifest" href="./favicon/site.webmanifest" />
    <link
      rel="mask-icon"
      href="./favicon/safari-pinned-tab.svg"
      color="#21284d"
    />
    <link rel="shortcut icon" href="./favicon/ardocent_32x32.png" />

    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="./favicon/browserconfig.xml" />
    <meta name="theme-color" content="#ffffff" />

    <!--  this is REQUIRED for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!--script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script-->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>

    <!--script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-chromakey-material/dist/aframe-chromakey-material.min.js"></script-->

    <script src="./material.js"></script>
    <script src="./event.js"></script>
    <script src="./components.js"></script>
    <script src="./cursor_m.js" defer></script>
    <script src="./vidhandler.js"></script>
    <script src="./mobile-detect-1.js"></script>
    <script src="./ioshandler.js"></script>
    <script src="./playvideo.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <script src="https://unpkg.com/merge-images"></script>
    <!--script type="text/javascript" src="./service-worker.js"></script-->


    <link rel="stylesheet" href="./hstyle.css" />

    <script>
      var mobile = /iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(
        navigator.userAgent.toLowerCase()
      );
      var userAgent = navigator.userAgent || navigator.vendor || window.opera;
      var footer_flag = document.getElementById("myFooter");

      var Browser = navigator.userAgent.toLowerCase();

      if (mobile) {
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
          if (Browser.indexOf("safari") > 90) {
            //                  alert(Browser.indexOf("safari"));
            //                    footer_flag.style.display = 'block';
          } else {
            //                  alert(Browser.indexOf("safari"));
            location.href = "ftp://117.52.89.118/pub/bridge_cj1.html";
          }

          //	           footer_flag.style.display = 'block';
        } else if (Browser.indexOf("chrome") < 90) {
          //                          alert(Browser.indexOf("chrome"));
        } else {
          //                         alert(Browser.indexOf("chrome"));
          location.href =
            "intent://ardocent.com/aframe/hmsbusan/cj1.html#Intent;scheme=https;package=com.android.chrome;end";
        }
      }
           else
              window.location.replace("./cj1-pc.html");


  //    self.addEventListener('activate', function(e) {
  //            e.waitUntil(
  //            caches.keys().then(function(keyList) {
  //               return Promise.all(keyList.map(function(key) {
  //            if(cacheName.indexOf(key) === -1) {
  //              return caches.delete(key);
  //            }
  //          }));
  //        })
  //      );
  //    });

         self.addEventListener('activate', function(e) {
    // Remove old caches
        e.waitUntil(
          (async () => {
            const keys = await caches.keys();
            return keys.map(async (cache) {
              if(cache !== cacheName) {
                console.log("Service Worker: Removing old cache: "  + cache);
                return await caches.delete(cache);
              }
            })
          })
        )
      })



      document.addEventListener('DOMContentLoaded', function() {
          var scene = document.querySelector('a-scene');
          var previd = document.querySelector('#vid');
          scene.addEventListener('loaded', function (e) {
              previd.stop();
          });
      });

    </script>

    <script>
      var cameraView;

      var constraints = {
        audio: false,
        video: {
          facingMode: "environment"
        }
      };

      // Access the device camera and stream to cameraView
      function cameraStart() {
        cameraView = document.querySelector("#webcam");
        navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function(stream) {
            cameraView.srcObject = stream;
          })
          .catch(function(error) {
            console.error("Oops. Something is broken.", error);
          });
      }

      // Start the video stream when the window loads
      window.addEventListener("load", cameraStart, false);

      //    const buttons = document.querySelector(".buttons")

      // buttons.addEventListener('click', cameraStart, false);

      // Component to change to a sequential color on cursor suspension.
//      AFRAME.registerComponent("cursor-listener", {
//        init: function() {
//          var lastIndex = -1;
//          var COLORS = ["red", "green", "blue"];
//          this.el.addEventListener("click", function(evt) {
//            lastIndex = (lastIndex + 1) % COLORS.length;
//            this.setAttribute("material", "color", COLORS[lastIndex]);
//            console.log("I was clicked at: ", evt.detail.intersection.point);
//          });
//        }
//      });
    </script>
  </head>

  <body style="margin : 0px; overflow: hidden;">
    <video id="webcam" autoplay playsinline></video>

    <a-scene
      device-orientation-permission-ui="enabled: false"
      loading-screen="dotsColor: red; backgroundColor: black"
      ar-session-notifier
      cursor-modifier
      playvideo
      raycaster="objects: .clickable"
      vr-mode-ui="enabled: false;"
      renderer="antialias: true; logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
      embedded
      arjs="trackingMethod: best; sourceType: #webcam; debugUIEnabled: false;"
      id="scene"
    >
      <a-assets>
        <img
          id="asset_btn_play"
          src="https://cdn.glitch.global/cb8cb838-9f19-470f-9aca-6e773483a84f/THW_LOGO_01.png?v=1708866075316"
        />

        <video
          src="https://cdn.glitch.global/cb8cb838-9f19-470f-9aca-6e773483a84f/Green%20screen%20%F0%9F%A7%9Afairy.mp4?v=1708852157461"
          type="video/mp4"
          preload="auto"
          id="vid"
          response-type="arraybuffer"
          
          crossorigin="anonymous"
          webkit-playsinline
          autoplay="none"
          playsinline
          style="display: none"
        ></video>
      </a-assets>
            <!--a-entity
        id="selector3"
        gltf-model="https://cdn.glitch.global/cb8cb838-9f19-470f-9aca-6e773483a84f/esferas_del_dragon.glb?v=1694653593175"
        scale="0.5 0.5 0.5"
        rotation="0 0 -50"
        position="0 -7.2 -38"
        visible="true"
        animation-mixer="clip: *; loop: pingpong; clampWhenFinished: true;"
        shadow="receive: false"
        animation="property: position; to: 0 1.1 -5; delay: 1500; dur: 15000; loop: false;"
        animation__1="property: rotation; to: 0 360 0; dur: 8000; loop: true;"
      ></a-entity>
                  <a-entity
        id="selector2"
        gltf-model="https://cdn.glitch.global/cb8cb838-9f19-470f-9aca-6e773483a84f/firelings.glb?v=1694654665038"
        scale="1 1 1"
        rotation="0 0 -50"
        position="0 -7.2 -38"
        visible="true"
        animation-mixer="clip: *; loop: pingpong; clampWhenFinished: true;"
        shadow="receive: false"
        animation="property: position; to: 0 1.1 -5; delay: 1500; dur: 15000; loop: false;"
        animation__1="property: rotation; to: 0 360 0; dur: 8000; loop: true;"
      ></a-entity-->
      <a-entity
        camera="active: true"
        look-controls
        wasd-controls
        position="0 0 5"
      >
        <a-entity
          id="myFooter"
          geometry="primitive: plane; height: 3; width: 2"
          material="side: double; src:#asset_btn_play"
          position="0 0 -4"
          rotation="0 0 0"
          class="clickable"
          onclick="vid.play()"
          event-set__click="_target: a-entity; visible: false;"
        >
        </a-entity>
        <a-entity
          geometry="primitive: plane; height: 4; width: 2.4"
          material="shader: chromakey; side: double; src: #vid; color: 0 0.9 0.1"
          vidhandler
          position="0 0 -2"
          rotation="0 0 0"
          class="clickable"
          event-set__enter="_event: mousedown"
        >
        </a-entity>
      </a-entity>
                    <!--a-entity
          id="balloon1"
          scale="10 10 10"
          position="0.2 1.5 -5"
          rotation="0 0 0"
          gltf-model="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/thunder.glb?v=1667137480995"
          shadow="receive: true"
          gesture-handler
          animation-mixer
          animation="property: rotation; to: 0 360 0; dur: 9000; delay: 200; loop: true"
        >
        </a-entity>
                    <a-entity
          id="balloon2"
          scale="10 10 10"
          position="0.2 1.5 -5"
          rotation="0 90 0"
          gltf-model="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/thunder.glb?v=1667137480995"
          shadow="receive: true"
          gesture-handler
          animation-mixer
          animation="property: rotation; to: 0 360 0; dur: 9000; delay: 200; loop: true"
        >
        </a-entity-->
                 <a-gltf-model
              rotation="0 0 0"
              position="0 -15.8 -3.5"
              scale="20 20 20"
              src="https://cdn.glitch.global/cb8cb838-9f19-470f-9aca-6e773483a84f/the_wine_glass.glb?v=1708868832615"
              class="glasses2-entity"   
              animation="property: rotation; to: 0 360 0; delay: 18000; dur: 5000; easing: linear; loop: false"
              animation__2="property: position; to: 0 -2.4 -2.5; delay: 18000; dur: 4000; easing: linear; loop: false"
              animation__3="property: rotation; to: 0 360 0; delay: 18000; dur: 20000; easing: linear; loop: true"            
              id="mickey-moon"
              ></a-gltf-model>
                                  <a-entity
          id="Msg-txt"
          visible="true"
          gltf-model="https://cdn.glitch.global/c4eb17c4-217f-42f1-9458-89bea57f734a/appearance_effect_starlight.glb?v=1708922837400"
          scale="10 10 10"
          position="0 -57.8 -30.5"
          rotation="0 0 0"
          animation__2="property: position; to: 0 -10.4 -1.5; delay: 18000; dur: 4000; easing: linear; loop: false"
          animation="property: rotation; to: 0 360 0; delay: 18000; dur: 5000; easing: linear; loop: false"
              

          animation-mixer
        ></a-entity>
                                        <!--a-entity
          id="Msg-txt"
          visible="true"
          gltf-model="https://cdn.glitch.global/06d05559-0ed0-41b1-938c-c5b9769f244e/tornado-pop.glb?v=1667810828296"
          scale="10 10 10"
          position="0 -17.8 -1.5"
          rotation="0 0 0"
                        animation="property: rotation; to: 0 360 0; delay: 18000; dur: 5000; easing: linear; loop: false"
              animation__2="property: position; to: 0 -2.4 -8.5; delay: 18000; dur: 4000; easing: linear; loop: false"
              animation__3="property: rotation; to: 0 360 0; delay: 18000; dur: 20000; easing: linear; loop: true"  
          animation-mixer
        ></a-entity-->
                                      <a-gltf-model
              rotation="0 0 0"
              position="0 -10.25 -3.6"
              scale="0.5 0.5 0.5"
              src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/firework.glb?v=1663132402330"
              class="hat2-entity"
              animation-mixer
            ></a-gltf-model>
                  <a-entity
        scale="5.5 5.5 5.5"
        position="0 -5 -4"
        rotation="0 0 0"
        visible="true"
        gltf-model="https://cdn.glitch.global/84219226-bfa8-4881-9a68-88e43606a2ce/confettiv2.glb?v=1668304368875"
        shadow="receive: true"
        animation-mixer
      >
      </a-entity>
                        <a-entity
        scale="6.1 6.1 6.1"
        position="0.5 -3 -5"
        rotation="45 0 0"
        visible="true"
        gltf-model="https://cdn.glitch.global/84219226-bfa8-4881-9a68-88e43606a2ce/confetti_fbx.glb?v=1668304614536"
        shadow="receive: true"
        animation-mixer
        event-set__click="_target: a-entity; visible: true;"
      >
      </a-entity>
      <a-light type="ambient" intensity="1.5"></a-light>
            <a-light
        type="directional"
        light="castShadow: true;
                      shadowMapHeight: 1024;
                      shadowMapWidth: 1024;
                      shadowCameraLeft: -7;
                      shadowCameraRight: 5;
                      shadowCameraBottom: -5;
                      shadowCameraTop: 5;"
        id="light"
        target="selector3"
        position="-1.8 4 1"
      ></a-light>
      <button class="button" id="mybutton"></button>
    </a-scene>

    <button class="capturebtn" id="capture" style="vertical-align:middle"></button>
    <button class="savebtn" id="save" style="vertical-align:middle">
      <!--a class="downbtn" id="download" download="capture.jpg"></a-->
    </button>
    <!-- The Modal -->
    <div id="myModal" class="modal" align="center">
      <!-- Modal content -->
      <div>
        <img class="modal-content" id="img01" />
        <span
          class="closebtn">
          <img
            src="./image/close.png"
            width="30px"
            height="30px"
          />
        </span>
        <div id="caption"></div>
      </div>
    </div>

    <!--div id="myModal" class="modal">
      <div class="hfc">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
      </div>
 </div-->

    <script type="text/javascript" src="./hmodal_button.js"></script>
    <script type="text/javascript" src="./hmodal_active.js"></script>
    <script type="text/javascript" src="./capture-pony.js"></script>
       
  </body>
</html>
